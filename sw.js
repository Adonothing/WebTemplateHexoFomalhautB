const CACHE_NAME="ICDNCache";let cachelist=[];self.addEventListener("install",(async function(e){self.skipWaiting(),e.waitUntil(caches.open(CACHE_NAME).then((function(e){return console.log("Opened cache"),e.addAll(cachelist)})))})),self.addEventListener("fetch",(async e=>{try{e.respondWith(handle(e.request))}catch(t){e.respondWith(handleerr(e.request,t))}}));const handleerr=async(e,t)=>new Response(`<h1>CDN分流器遇到了致命错误</h1>\n    <b>${t}</b>`,{headers:{"content-type":"text/html; charset=utf-8"}}),lfetch=async(e,t)=>{let n=new AbortController;const a=async e=>new Response(await e.arrayBuffer(),{status:e.status,headers:e.headers});return Promise.any||(Promise.any=function(e){return new Promise(((t,n)=>{let a=(e=Array.isArray(e)?e:[]).length,s=[];if(0===a)return n(new AggregateError("All promises were rejected"));e.forEach((e=>{e.then((e=>{t(e)}),(e=>{a--,s.push(e),0===a&&n(new AggregateError(s))}))}))}))}),Promise.any(e.map((e=>new Promise(((t,s)=>{fetch(e,{signal:n.signal}).then(a).then((e=>{200==e.status?(n.abort(),t(e)):s(e)}))})))))};self.addEventListener("fetch",(async e=>{e.respondWith(handle(e.request))}));const fullpath=e=>((e=e.split("?")[0].split("#")[0]).match(/\/$/)&&(e+="index"),e.match(/\.[a-zA-Z]+$/)||(e+=".html"),e),handle=async e=>{const t=e.url,n=new URL(t),a=n.pathname;return""===n.hostname?lfetch(["fomalhaut.s3.ladydaily.com"+(s=a,(s=s.split("?")[0].split("#")[0]).match(/\/$/)&&(s+="index"),s.match(/\.[a-zA-Z]+$/)||(s+=".html"),s)]):fetch(e);var s};